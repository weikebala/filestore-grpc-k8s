version: '2'

services:
# apigw service
  apigw:
    image: weikebala/filestore_grpc_k8s_apigw
    networks:
      - web
    labels:
      - "traefik.backend=apigw"
      - "traefik.frontend.rule=Host:apigw.fileserver.com"
      - "traefik.docker.port=8080"
# upload service
  upload:
    image: weikebala/filestore_grpc_k8s_upload
    networks:
      - web
    volumes:
      - /data/fileserver:/data/fileserver
      - /data/fileserver_part:/data/fileserver_part
    labels:
      - "traefik.backend=upload"
      - "traefik.frontend.rule=Host:upload.fileserver.com"
      - "traefik.docker.port=28080"
# download service
  download:
    image: weikebala/filestore_grpc_k8s_download
    networks:
      - web
    volumes:
      - /data/fileserver:/data/fileserver
      - /data/fileserver_part:/data/fileserver_part
    labels:
      - "traefik.backend=download"
      - "traefik.frontend.rule=Host:download.fileserver.com"
      - "traefik.docker.port=38080"
# account service
  account:
    image: weikebala/filestore_grpc_k8s_account
    networks:
      - web
# dbproxy service
  dbproxy:
    image: weikebala/filestore_grpc_k8s_dbproxy
    networks:
      - web
networks:
  web:
    external:
      name: fileserver